<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ideas Textiles ERP </title>
    
    <script src="https://kit.fontawesome.com/d0b9472d3e.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: { brand: { 900: '#0f172a', 800: '#1e293b', 500: '#3b82f6' } }
                }
            }
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* Estilos base para scrollbars y transiciones */
        body { background-color: #f1f5f9; overflow: hidden; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .view-section { transition: opacity 0.3s ease; height: 100vh; width: 100%; overflow: hidden; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .nav-item.active { background-color: #eff6ff; color: #2563eb; border-right: 3px solid #2563eb; }
        .kanban-col { min-height: 200px; }
    </style>
</head>
<body class="text-slate-800 antialiased select-none">

    <div class="flex h-screen w-screen overflow-hidden">
        
        <aside class="w-20 bg-white border-r border-slate-200 flex flex-col items-center py-6 z-50 shadow-xl">
            <div class="mb-8 w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center text-white font-black text-lg shadow-lg shadow-slate-900/30">
                IT
            </div>

            <nav class="flex-1 flex flex-col gap-4 w-full">
                <div class="nav-item active h-16 w-full flex flex-col items-center justify-center cursor-pointer text-slate-400 hover:text-slate-600 transition group" onclick="App.UI.switchView('operations')" id="btn-operations">
                    <i class="fa-solid fa-clipboard-list text-xl mb-1 group-hover:scale-110 transition"></i>
                    <span class="text-[9px] font-bold tracking-wide">KANBAN</span>
                </div>

                <div class="nav-item h-16 w-full flex flex-col items-center justify-center cursor-pointer text-slate-400 hover:text-slate-600 transition group" onclick="App.UI.switchView('inventory')" id="btn-inventory">
                    <i class="fa-solid fa-shirt text-xl mb-1 group-hover:scale-110 transition"></i>
                    <span class="text-[9px] font-bold tracking-wide">STOCK</span>
                </div>

                <div class="nav-item h-16 w-full flex flex-col items-center justify-center cursor-pointer text-slate-400 hover:text-slate-600 transition group" onclick="App.UI.switchView('agenda')" id="btn-agenda">
                    <i class="fa-solid fa-calendar-days text-xl mb-1 group-hover:scale-110 transition"></i>
                    <span class="text-[9px] font-bold tracking-wide">AGENDA</span>
                </div>

                <div class="nav-item h-16 w-full flex flex-col items-center justify-center cursor-pointer text-slate-400 hover:text-slate-600 transition group" onclick="App.UI.switchView('camera-hub')" id="btn-camera-hub">
                    <i class="fa-solid fa-camera text-xl mb-1 group-hover:scale-110 transition"></i>
                    <span class="text-[9px] font-bold tracking-wide">SCAN</span>
                </div>
            </nav>

            <div class="mb-2 text-slate-300 hover:text-red-500 cursor-pointer transition">
                <i class="fa-solid fa-power-off"></i>
            </div>
        </aside>

        <main class="flex-1 relative bg-slate-100 h-full overflow-hidden">

            <section id="view-operations" class="view-section flex flex-col h-full">
                <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8">
                    <div>
                        <h1 class="text-xl font-black text-slate-900 tracking-tight">TABLERO DE CONTROL</h1>
                        <p class="text-xs text-slate-500 font-medium">Gestión de Producción en Tiempo Real</p>
                    </div>
                    <button onclick="App.Controllers.Order.create()" class="bg-slate-900 hover:bg-slate-800 text-white px-5 py-2.5 rounded-full font-bold text-xs shadow-lg shadow-slate-900/20 transition active:scale-95 flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i> NUEVA ORDEN
                    </button>
                </header>

                <div class="flex-1 overflow-x-auto overflow-y-hidden p-6">
                    <div class="flex gap-6 h-full min-w-[1000px]">
                        <div class="flex-1 flex flex-col bg-slate-200/50 rounded-2xl p-4 border border-slate-200/60">
                            <div class="flex justify-between items-center mb-4 px-2">
                                <h3 class="font-black text-xs text-slate-500 uppercase tracking-wider"><i class="fa-solid fa-file-signature mr-2"></i>Solicitud</h3>
                                <span class="bg-white text-slate-600 text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm" id="count-request">0</span>
                            </div>
                            <div id="col-request" class="kanban-col flex-1 space-y-3 overflow-y-auto pr-1 hide-scroll" ondrop="App.UI.drop(event, 'request')" ondragover="App.UI.allowDrop(event)"></div>
                        </div>

                        <div class="flex-1 flex flex-col bg-blue-50/50 rounded-2xl p-4 border border-blue-100">
                            <div class="flex justify-between items-center mb-4 px-2">
                                <h3 class="font-black text-xs text-blue-500 uppercase tracking-wider"><i class="fa-solid fa-scissors mr-2"></i>En Taller</h3>
                                <span class="bg-white text-blue-600 text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm" id="count-process">0</span>
                            </div>
                            <div id="col-process" class="kanban-col flex-1 space-y-3 overflow-y-auto pr-1 hide-scroll" ondrop="App.UI.drop(event, 'process')" ondragover="App.UI.allowDrop(event)"></div>
                        </div>

                        <div class="flex-1 flex flex-col bg-green-50/50 rounded-2xl p-4 border border-green-100">
                            <div class="flex justify-between items-center mb-4 px-2">
                                <h3 class="font-black text-xs text-green-600 uppercase tracking-wider"><i class="fa-solid fa-check-circle mr-2"></i>Terminado</h3>
                                <span class="bg-white text-green-600 text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm" id="count-finished">0</span>
                            </div>
                            <div id="col-finished" class="kanban-col flex-1 space-y-3 overflow-y-auto pr-1 hide-scroll" ondrop="App.UI.drop(event, 'finished')" ondragover="App.UI.allowDrop(event)"></div>
                        </div>
                         <div class="flex-1 flex flex-col bg-slate-200/30 rounded-2xl p-4 border border-slate-200/60 opacity-80">
                            <div class="flex justify-between items-center mb-4 px-2">
                                <h3 class="font-black text-xs text-slate-400 uppercase tracking-wider"><i class="fa-solid fa-truck-fast mr-2"></i>Entregado</h3>
                                <span class="bg-white text-slate-500 text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm" id="count-delivered">0</span>
                            </div>
                            <div id="col-delivered" class="kanban-col flex-1 space-y-3 overflow-y-auto pr-1 hide-scroll" ondrop="App.UI.drop(event, 'delivered')" ondragover="App.UI.allowDrop(event)"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="view-inventory" class="view-section hidden flex flex-col h-full bg-slate-50">
                <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 sticky top-0 z-10">
                    <h1 class="text-xl font-black text-slate-900 tracking-tight">ALMACÉN GENERAL</h1>
                    <div class="flex gap-3">
                        <div class="relative">
                            <i class="fa-solid fa-search absolute left-3 top-2.5 text-slate-400 text-xs"></i>
                            <input type="text" onkeyup="App.Controllers.Inventory.filter()" id="inv-search" placeholder="Buscar producto..." class="pl-8 pr-4 py-2 bg-slate-100 border-none rounded-full text-xs font-bold w-64 focus:ring-2 ring-blue-500 outline-none">
                        </div>
                        <button onclick="App.Controllers.Inventory.openModal()" class="bg-blue-600 text-white w-8 h-8 rounded-full shadow hover:bg-blue-700 transition"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </header>
                <div id="inventory-grid" class="p-8 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 overflow-y-auto pb-20">
                    </div>
            </section>

            <section id="view-agenda" class="view-section hidden flex flex-col h-full bg-white">
                <header class="h-16 px-8 flex items-center justify-between border-b border-slate-100">
                    <h1 class="text-xl font-black text-slate-900">AGENDA DE ENTREGAS</h1>
                    <div class="flex items-center gap-4">
                        <h2 id="current-month-display" class="text-sm font-bold text-slate-600 uppercase w-32 text-center">ENERO 2026</h2>
                        <div class="flex bg-slate-100 rounded-lg p-1">
                            <button class="w-8 h-8 rounded hover:bg-white text-slate-500"><i class="fa-solid fa-chevron-left"></i></button>
                            <button class="w-8 h-8 rounded hover:bg-white text-slate-500"><i class="fa-solid fa-chevron-right"></i></button>
                        </div>
                    </div>
                </header>
                <div class="flex-1 flex flex-col p-8 overflow-hidden">
                    <div class="grid grid-cols-7 mb-2">
                        <div class="text-center text-[10px] font-black text-slate-400 uppercase">Lun</div>
                        <div class="text-center text-[10px] font-black text-slate-400 uppercase">Mar</div>
                        <div class="text-center text-[10px] font-black text-slate-400 uppercase">Mie</div>
                        <div class="text-center text-[10px] font-black text-slate-400 uppercase">Jue</div>
                        <div class="text-center text-[10px] font-black text-slate-400 uppercase">Vie</div>
                        <div class="text-center text-[10px] font-black text-slate-400 uppercase text-red-400">Sab</div>
                        <div class="text-center text-[10px] font-black text-slate-400 uppercase text-red-400">Dom</div>
                    </div>
                    <div id="calendar-grid-container" class="flex-1 grid grid-cols-7 border-l border-t border-slate-200 bg-slate-200 gap-[1px] overflow-y-auto">
                        </div>
                </div>
            </section>

            <section id="view-camera-hub" class="view-section absolute inset-0 flex flex-col hidden bg-black z-[60]">
                <header class="absolute top-0 left-0 right-0 h-16 flex items-center justify-between px-6 z-20 bg-gradient-to-b from-black/80 to-transparent">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-white/20 backdrop-blur flex items-center justify-center text-white">
                            <i class="fa-solid fa-qrcode"></i>
                        </div>
                        <div>
                            <h2 class="text-white font-bold text-sm tracking-wide">MODO ESCANER</h2>
                            <p class="text-white/60 text-[10px] uppercase font-mono">Reconocimiento Activo</p>
                        </div>
                    </div>
                    <button onclick="App.UI.switchView('operations')" class="text-white bg-white/10 w-8 h-8 rounded-full flex items-center justify-center backdrop-blur">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </header>
                
                <div class="flex-1 relative flex flex-col relative overflow-hidden">
                    <video id="hub-video-feed" autoplay playsinline class="absolute inset-0 w-full h-full object-cover z-0"></video>
                    
                    <div class="absolute inset-0 z-10 pointer-events-none">
                        <div class="absolute inset-0 bg-black/40"></div>
                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[80%] aspect-square max-w-sm rounded-3xl border-[3px] border-white/80 shadow-[0_0_0_9999px_rgba(0,0,0,0.6)]">
                            <div class="absolute top-0 left-0 w-8 h-8 border-l-4 border-t-4 border-blue-500 rounded-tl-2xl -translate-x-1 -translate-y-1"></div>
                            <div class="absolute top-0 right-0 w-8 h-8 border-r-4 border-t-4 border-blue-500 rounded-tr-2xl translate-x-1 -translate-y-1"></div>
                            <div class="absolute bottom-0 left-0 w-8 h-8 border-l-4 border-b-4 border-blue-500 rounded-bl-2xl -translate-x-1 translate-y-1"></div>
                            <div class="absolute bottom-0 right-0 w-8 h-8 border-r-4 border-b-4 border-blue-500 rounded-br-2xl translate-x-1 translate-y-1"></div>
                            <div class="absolute left-2 right-2 h-[2px] bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.8)] animate-[scan_2s_ease-in-out_infinite]"></div>
                        </div>
                        <div class="absolute top-2/3 left-0 right-0 text-center mt-12">
                            <p class="text-white font-bold text-lg drop-shadow-md">Escanea un producto</p>
                            <p class="text-white/70 text-sm">Coloca el código o la prenda en el cuadro</p>
                        </div>
                    </div>

                    <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black via-black/80 to-transparent z-20 flex items-center justify-center gap-8 pb-4">
                        <button onclick="App.Controllers.CameraHub.capture()" class="w-20 h-20 rounded-full border-4 border-white flex items-center justify-center bg-white/20 backdrop-blur active:scale-95 transition-all">
                            <div class="w-16 h-16 bg-white rounded-full shadow-inner"></div>
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="modal-order" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" onclick="App.Controllers.Order.close()"></div>
        <div class="absolute top-0 right-0 w-full md:w-[600px] h-full bg-white shadow-2xl transform transition-transform duration-300 translate-x-full flex flex-col" id="modal-order-panel">
            
            <div class="h-20 border-b flex items-center justify-between px-8 bg-slate-50">
                <div>
                    <h2 class="text-xl font-black text-slate-800">GESTIÓN DE ORDEN</h2>
                    <p class="text-xs text-slate-500 font-medium">Detalle de producción y trazabilidad</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="App.PDF.generateFormalOrder()" class="w-10 h-10 rounded-full border border-slate-200 text-slate-600 hover:bg-blue-50 hover:text-blue-600 flex items-center justify-center transition" title="PDF Formal (Precios)">
                        <i class="fa-solid fa-file-invoice"></i>
                    </button>
                    <button onclick="App.PDF.generateLabel()" class="w-10 h-10 rounded-full border border-slate-200 text-slate-600 hover:bg-purple-50 hover:text-purple-600 flex items-center justify-center transition" title="Etiqueta Despacho">
                        <i class="fa-solid fa-tag"></i>
                    </button>
                    <button onclick="App.Controllers.Order.close()" class="w-10 h-10 rounded-full bg-slate-200 text-slate-500 hover:bg-red-50 hover:text-red-500 flex items-center justify-center transition ml-2">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-8 bg-white">
                <div class="grid grid-cols-2 gap-4 mb-6 p-4 bg-slate-50 rounded-xl border border-slate-100">
                    <div class="space-y-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Cliente</label>
                            <input type="text" id="inp-client" class="w-full p-2 bg-white border border-slate-200 rounded font-bold text-slate-700 outline-none focus:border-blue-500 transition text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Orden de Compra</label>
                            <input type="text" id="inp-oc" class="w-full p-2 bg-white border border-slate-200 rounded font-mono text-sm outline-none focus:border-blue-500 transition">
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Fecha Entrega</label>
                            <input type="date" id="inp-date" class="w-full p-2 bg-white border border-slate-200 rounded font-mono text-sm outline-none focus:border-blue-500 transition text-slate-600">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Doc. Tributario</label>
                            <input type="text" id="inp-invoice" class="w-full p-2 bg-white border border-slate-200 rounded font-mono text-sm outline-none focus:border-blue-500 transition">
                        </div>
                    </div>
                </div>

                <div class="mb-4 flex justify-between items-end">
                    <h3 class="text-sm font-bold text-slate-700 uppercase">Items de la Orden</h3>
                    <button onclick="App.Controllers.Order.addRow()" class="text-xs text-blue-600 font-bold hover:underline">+ Agregar Fila</button>
                </div>
                <div id="order-rows-container">
                    </div>
            </div>

            <div class="p-6 border-t bg-slate-50">
                <button onclick="App.Controllers.Order.save()" class="w-full py-4 bg-slate-900 text-white font-bold rounded-xl shadow-xl hover:bg-slate-800 transition active:scale-95">
                    GUARDAR CAMBIOS
                </button>
            </div>
        </div>
    </div>

    <div id="modal-inventory-advanced" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="App.Controllers.Inventory.closeModal()"></div>
        <div class="relative bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-100">
            <div class="bg-slate-900 px-6 py-5 flex justify-between items-center">
                <div>
                    <h3 class="text-white font-bold text-lg tracking-wide">FICHA DE PRODUCTO</h3>
                    <p class="text-slate-400 text-xs uppercase font-mono">Edición Master</p>
                </div>
                <button onclick="App.Controllers.Inventory.closeModal()" class="text-white/50 hover:text-white transition">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            <div class="p-6 space-y-5">
                <div class="grid grid-cols-3 gap-4">
                    <div class="col-span-1">
                        <label class="block text-xs font-bold text-slate-500 mb-1">SKU</label>
                        <input type="text" id="inv-sku" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg font-mono text-sm uppercase" placeholder="ABC-001">
                    </div>
                    <div class="col-span-2">
                        <label class="block text-xs font-bold text-slate-500 mb-1">NOMBRE</label>
                        <input type="text" id="inv-name" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm" placeholder="Ej: Polera Piqué">
                    </div>
                </div>
                <div class="bg-slate-50 rounded-xl p-4 border border-slate-200">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-xs font-black text-slate-700 uppercase">Variantes / Stock</span>
                        <button onclick="App.Controllers.Inventory.addVariantRow()" class="text-xs bg-blue-100 text-blue-700 px-3 py-1 rounded-md font-bold">+ Talla</button>
                    </div>
                    <div id="inv-variants-container" class="space-y-2 max-h-48 overflow-y-auto pr-1"></div>
                </div>
                <button onclick="App.Controllers.Inventory.save()" class="w-full py-3.5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg transition">GUARDAR</button>
            </div>
        </div>
    </div>

    <div id="modal-day" class="fixed inset-0 z-[150] hidden">
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity" onclick="App.Controllers.Calendar.closeDay()"></div>
        <div class="absolute inset-x-0 bottom-0 h-[85vh] bg-white rounded-t-3xl shadow-2xl flex flex-col transform transition-transform duration-300 translate-y-full" id="modal-day-panel">
            <div class="px-8 py-6 border-b flex justify-between items-center bg-slate-50 rounded-t-3xl">
                <div>
                    <h3 class="text-2xl font-black text-slate-800" id="day-title">FECHA</h3>
                    <p class="text-sm text-slate-500 font-bold uppercase tracking-wider">Bitácora Diaria</p>
                </div>
                <button onclick="App.Controllers.Calendar.closeDay()" class="w-10 h-10 rounded-full bg-white shadow flex items-center justify-center text-slate-500">
                    <i class="fa-solid fa-chevron-down"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-8 space-y-8">
                <div>
                    <h4 class="font-bold text-slate-400 text-xs uppercase mb-4"><i class="fa-solid fa-truck-fast mr-2"></i>Entregas Programadas</h4>
                    <div id="day-orders-list" class="space-y-3"></div>
                </div>
                <hr class="border-dashed border-slate-200">
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold text-slate-400 text-xs uppercase"><i class="fa-solid fa-pencil mr-2"></i>Notas / Recordatorios</h4>
                        <button onclick="App.Controllers.Calendar.addNote()" class="text-xs bg-blue-50 text-blue-600 px-3 py-1 rounded-lg font-bold">+ Nota</button>
                    </div>
                    <div id="day-notes-list" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script src="app.js"></script>
    <style>
        @keyframes scan { 0% { top: 10%; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { top: 90%; opacity: 0; } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</body>
</html>
