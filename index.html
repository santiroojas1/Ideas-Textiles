<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDEAS TEXTILES</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Estilos personalizados para el calendario */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        .calendar-day {
            aspect-ratio: 1/1;
            border: 1px solid #e5e7eb;
            padding: 5px;
            font-size: 0.9rem;
            position: relative;
        }
        .calendar-header {
            font-weight: bold;
            text-align: center;
            padding: 10px 0;
            background-color: #f3f4f6;
        }
        .today {
            background-color: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800">

    <div class="flex h-screen overflow-hidden">
        
        <aside class="w-64 bg-gray-900 text-white flex-shrink-0 hidden md:flex flex-col shadow-xl">
            <div class="p-6 flex items-center justify-center border-b border-gray-700">
                <i class="fas fa-scissors text-3xl text-yellow-500 mr-3"></i>
                <h2 class="text-xl font-bold tracking-wider">GESTIÓN</h2>
            </div>
            <nav class="mt-6 flex-1 px-4 space-y-2">
                <a href="#" onclick="showSection('dashboard')" class="nav-item block py-3 px-4 rounded hover:bg-gray-700 transition flex items-center bg-gray-800">
                    <i class="fas fa-home w-6"></i> Dashboard
                </a>
                <a href="#" onclick="showSection('orders')" class="nav-item block py-3 px-4 rounded hover:bg-gray-700 transition flex items-center">
                    <i class="fas fa-file-invoice w-6"></i> Órdenes (OC)
                </a>
                <a href="#" onclick="showSection('inventory')" class="nav-item block py-3 px-4 rounded hover:bg-gray-700 transition flex items-center">
                    <i class="fas fa-boxes w-6"></i> Inventario
                </a>
                <a href="#" onclick="showSection('calendar')" class="nav-item block py-3 px-4 rounded hover:bg-gray-700 transition flex items-center">
                    <i class="fas fa-calendar-alt w-6"></i> Calendario
                </a>
            </nav>
            <div class="p-4 border-t border-gray-700">
                <p class="text-xs text-gray-400 text-center">v2.4 - Sistema Corregido</p>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            
            <header class="bg-white shadow-sm z-10 p-4 flex justify-between items-center border-b-4 border-yellow-500">
                <div class="flex items-center">
                    <button class="md:hidden mr-4 text-gray-600 focus:outline-none">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                    <h1 class="text-2xl font-black text-gray-800 tracking-wider uppercase flex items-center">
                        WORKWEAR AND CORPORATE 
                        <i class="fas fa-scissors ml-3 text-yellow-600"></i>
                    </h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm font-semibold text-gray-600" id="currentDateDisplay"></span>
                    <div class="h-8 w-8 rounded-full bg-yellow-500 flex items-center justify-center text-white font-bold">
                        A
                    </div>
                </div>
            </header>

            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-6" id="main-container">
                
                <div id="dashboard" class="section-content">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700">Resumen General</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow border-l-4 border-blue-500">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-500 mr-4">
                                    <i class="fas fa-clipboard-list text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Total Órdenes</p>
                                    <p class="text-2xl font-bold" id="total-orders-count">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow border-l-4 border-green-500">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-500 mr-4">
                                    <i class="fas fa-box-open text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Items Inventario</p>
                                    <p class="text-2xl font-bold" id="total-inventory-count">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow border-l-4 border-yellow-500">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
                                    <i class="fas fa-clock text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Pendientes</p>
                                    <p class="text-2xl font-bold">3</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="orders" class="section-content hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-700">Órdenes de Compra</h2>
                        <button onclick="openModal('orderModal')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded shadow flex items-center">
                            <i class="fas fa-plus mr-2"></i> Nueva OC
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="min-w-full leading-normal">
                            <thead>
                                <tr>
                                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ID OC</th>
                                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Cliente</th>
                                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Fecha</th>
                                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Estado</th>
                                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body">
                                </tbody>
                        </table>
                        <div id="no-orders-msg" class="p-5 text-center text-gray-500 hidden">No hay órdenes registradas.</div>
                    </div>
                </div>

                <div id="inventory" class="section-content hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-700">Inventario de Productos</h2>
                        <button onclick="openModal('inventoryModal')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded shadow flex items-center">
                            <i class="fas fa-plus mr-2"></i> Nuevo Producto
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="min-w-full leading-normal">
                            <thead>
                                <tr>
                                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">SKU</th>
                                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Producto</th>
                                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Categoría</th>
                                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Stock</th>
                                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-table-body">
                                </tbody>
                        </table>
                        <div id="no-inventory-msg" class="p-5 text-center text-gray-500 hidden">Inventario vacío.</div>
                    </div>
                </div>

                <div id="calendar" class="section-content hidden">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700">Agenda Mensual</h2>
                    <div class="bg-white rounded-lg shadow p-4 max-w-4xl mx-auto">
                        
                        <div class="flex justify-between items-center mb-4">
                            <button onclick="changeMonth(-1)" class="p-2 hover:bg-gray-200 rounded"><i class="fas fa-chevron-left"></i></button>
                            <h3 id="calendar-month-year" class="text-xl font-bold uppercase">Enero 2026</h3>
                            <button onclick="changeMonth(1)" class="p-2 hover:bg-gray-200 rounded"><i class="fas fa-chevron-right"></i></button>
                        </div>

                        <div class="grid grid-cols-7 mb-2 text-center text-sm font-semibold text-gray-500">
                            <div>DOM</div>
                            <div>LUN</div>
                            <div>MAR</div>
                            <div>MIE</div>
                            <div>JUE</div>
                            <div>VIE</div>
                            <div>SAB</div>
                        </div>

                        <div id="calendar-days-grid" class="calendar-grid">
                            </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <div id="orderModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-900">Nueva Orden de Compra</h3>
                <button onclick="closeModal('orderModal')" class="text-gray-500 hover:text-red-500"><i class="fas fa-times"></i></button>
            </div>
            <form id="orderForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Cliente</label>
                    <input type="text" id="orderClient" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Ej: Minera Escondida">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">ID Orden</label>
                    <input type="text" id="orderId" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Ej: OC-2024-001">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Fecha Entrega</label>
                    <input type="date" id="orderDate" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="flex justify-end">
                    <button type="button" onclick="closeModal('orderModal')" class="bg-gray-400 text-white px-4 py-2 rounded mr-2 hover:bg-gray-500">Cancelar</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Guardar OC</button>
                </div>
            </form>
        </div>
    </div>

    <div id="inventoryModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-900">Nuevo Producto</h3>
                <button onclick="closeModal('inventoryModal')" class="text-gray-500 hover:text-red-500"><i class="fas fa-times"></i></button>
            </div>
            <form id="inventoryForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">SKU / Código</label>
                    <input type="text" id="prodSku" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Nombre Producto</label>
                    <input type="text" id="prodName" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Categoría</label>
                    <select id="prodCat" class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option>Ropa Ignífuga</option>
                        <option>Corporativo</option>
                        <option>EPP</option>
                        <option>Calzado</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Stock Inicial</label>
                    <input type="number" id="prodStock" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="flex justify-end">
                    <button type="button" onclick="closeModal('inventoryModal')" class="bg-gray-400 text-white px-4 py-2 rounded mr-2 hover:bg-gray-500">Cancelar</button>
                    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Guardar Item</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS LOCAL (Arrays) ---
        let orders = JSON.parse(localStorage.getItem('ordersData')) || [];
        let inventory = JSON.parse(localStorage.getItem('inventoryData')) || [];

        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            renderOrders();
            renderInventory();
            updateDashboard();
            renderCalendar(); // Inicializar calendario
            
            // Fecha actual en header
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDateDisplay').textContent = new Date().toLocaleDateString('es-ES', options);
        });

        // --- NAVEGACIÓN ---
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section-content').forEach(el => el.classList.add('hidden'));
            // Mostrar la seleccionada
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Actualizar estilo activo del sidebar
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('bg-gray-800'));
            // (Lógica simple de highlight, se puede mejorar buscando el elemento clickeado)
        }

        // --- MODALES ---
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // --- LÓGICA DE ÓRDENES (OC) ---
        const orderForm = document.getElementById('orderForm');
        
        orderForm.addEventListener('submit', function(e) {
            // PIENSA: Evitar recarga
            e.preventDefault(); 

            // Obtener valores
            const client = document.getElementById('orderClient').value;
            const id = document.getElementById('orderId').value;
            const date = document.getElementById('orderDate').value;

            // Crear objeto
            const newOrder = {
                id: id,
                client: client,
                date: date,
                status: 'Pendiente'
            };

            // Guardar en Array
            orders.push(newOrder);
            
            // Guardar en LocalStorage
            localStorage.setItem('ordersData', JSON.stringify(orders));

            // PIENSA: Actualizar la vista INMEDIATAMENTE
            renderOrders();
            updateDashboard();

            // Limpiar y cerrar
            orderForm.reset();
            closeModal('orderModal');
            
            // Feedback
            alert('OC Guardada Correctamente');
        });

        function renderOrders() {
            const tbody = document.getElementById('orders-table-body');
            const noDataMsg = document.getElementById('no-orders-msg');
            
            tbody.innerHTML = ''; // Limpiar tabla antes de pintar

            if (orders.length === 0) {
                noDataMsg.classList.remove('hidden');
                return;
            } else {
                noDataMsg.classList.add('hidden');
            }

            orders.forEach((order, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm font-bold text-gray-900">${order.id}</td>
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-gray-900">${order.client}</td>
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-gray-900">${order.date}</td>
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                        <span class="relative inline-block px-3 py-1 font-semibold text-orange-900 leading-tight">
                            <span aria-hidden class="absolute inset-0 bg-orange-200 opacity-50 rounded-full"></span>
                            <span class="relative">${order.status}</span>
                        </span>
                    </td>
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                        <button onclick="deleteOrder(${index})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function deleteOrder(index) {
            if(confirm('¿Eliminar esta orden?')) {
                orders.splice(index, 1);
                localStorage.setItem('ordersData', JSON.stringify(orders));
                renderOrders();
                updateDashboard();
            }
        }

        // --- LÓGICA DE INVENTARIO ---
        const inventoryForm = document.getElementById('inventoryForm');

        inventoryForm.addEventListener('submit', function(e) {
            e.preventDefault(); // PIENSA: Importante

            const sku = document.getElementById('prodSku').value;
            const name = document.getElementById('prodName').value;
            const cat = document.getElementById('prodCat').value;
            const stock = document.getElementById('prodStock').value;

            const newItem = { sku, name, cat, stock };

            inventory.push(newItem);
            localStorage.setItem('inventoryData', JSON.stringify(inventory));

            renderInventory(); // PIENSA: Repintar
            updateDashboard();

            inventoryForm.reset();
            closeModal('inventoryModal');
            alert('Producto Agregado');
        });

        function renderInventory() {
            const tbody = document.getElementById('inventory-table-body');
            const noDataMsg = document.getElementById('no-inventory-msg');
            
            tbody.innerHTML = '';

            if (inventory.length === 0) {
                noDataMsg.classList.remove('hidden');
                return;
            } else {
                noDataMsg.classList.add('hidden');
            }

            inventory.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm font-mono text-gray-600">${item.sku}</td>
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm font-bold text-gray-800">${item.name}</td>
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-gray-600">${item.cat}</td>
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm font-bold text-green-600">${item.stock} u.</td>
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                        <button onclick="deleteInventory(${index})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function deleteInventory(index) {
            inventory.splice(index, 1);
            localStorage.setItem('inventoryData', JSON.stringify(inventory));
            renderInventory();
            updateDashboard();
        }

        // --- DASHBOARD ---
        function updateDashboard() {
            document.getElementById('total-orders-count').innerText = orders.length;
            document.getElementById('total-inventory-count').innerText = inventory.length;
        }

        // --- CALENDARIO TIPO CELULAR (GRID COMPLETO) ---
        let currDate = new Date();
        
        function renderCalendar() {
            const monthYear = document.getElementById('calendar-month-year');
            const daysGrid = document.getElementById('calendar-days-grid');
            
            // Limpiar grid anterior
            daysGrid.innerHTML = '';
            
            const year = currDate.getFullYear();
            const month = currDate.getMonth();
            
            // Nombres de meses
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            
            monthYear.innerText = `${monthNames[month]} ${year}`;
            
            // Primer día del mes (para saber dónde empezar a pintar)
            const firstDayIndex = new Date(year, month, 1).getDay(); // 0 = Domingo
            
            // Total días en el mes actual
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Total días mes anterior (para rellenar huecos)
            const prevLastDay = new Date(year, month, 0).getDate();
            
            // FECHA DE HOY REAL (para marcar el círculo azul)
            const todayReal = new Date();

            // 1. Rellenar días vacíos del mes anterior (Grises)
            for (let x = firstDayIndex; x > 0; x--) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day text-gray-300 bg-gray-50';
                dayDiv.innerText = prevLastDay - x + 1;
                daysGrid.appendChild(dayDiv);
            }
            
            // 2. Rellenar días del mes actual
            for (let i = 1; i <= daysInMonth; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day bg-white hover:bg-blue-50 cursor-pointer';
                
                // Verificar si es HOY
                if (i === todayReal.getDate() && month === todayReal.getMonth() && year === todayReal.getFullYear()) {
                    dayDiv.innerHTML = `<div class="today">${i}</div>`;
                } else {
                    dayDiv.innerText = i;
                }
                
                // Verificar si hay una OC ese día (Pequeño punto indicador)
                // Formato fecha input: YYYY-MM-DD
                const checkDateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                const hasOrder = orders.some(o => o.date === checkDateStr);
                
                if (hasOrder) {
                    const dot = document.createElement('div');
                    dot.className = 'absolute bottom-1 right-1 w-2 h-2 bg-yellow-500 rounded-full';
                    dayDiv.appendChild(dot);
                }

                daysGrid.appendChild(dayDiv);
            }
            
            // 3. Rellenar huecos finales (opcional, para cuadrar la grilla visualmente)
            const totalSlots = daysGrid.children.length;
            const nextDays = 42 - totalSlots; // 6 filas de 7 = 42
            
            for (let j = 1; j <= nextDays; j++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day text-gray-300 bg-gray-50';
                dayDiv.innerText = j;
                daysGrid.appendChild(dayDiv);
            }
        }

        function changeMonth(dir) {
            currDate.setMonth(currDate.getMonth() + dir);
            renderCalendar();
        }

    </script>
</body>
</html>
